# Package `easy_regression` {#easy_regression}

<move-here src="#easy_regression-autogenerated"/>

## Design goals


TODO: to write

## Formalization

A regression test is defined by the following:

1. A set of logs on which to operate.
2. Zero or more "processors". A processor takes a bag as input and write a bag in output.
3. Zero or more "analyzers": these are objects that analyze the results.
5. Zero or more "acceptance conditions". These are the conditions on the results of the analyzers.

Let's go more in detail, to obtain a formalization that can be used
to parallelize the processing.

This is in the spirit of a map/reduce framework.

See: Map-reduce framework XXX

We assume that a processor has the following signature:

\[
    \text{processor}: \text{Bag} \rightarrow \text{Bag}
\]

An analyzer is something that returns a statistics of type `Stat`:

\[
    \text{analyzer}: \text{Bag} \rightarrow \text{Stat}
\]

We also assume to have an operation `merge` that allows to merge
the results of two statistics:

\[
    \text{merge}: \text{Stat} \times \text{Stat} \rightarrow \text{Stat}
\]

Finally, the acceptance condition is a test on the statistics.
We want to be careful about the possible conditions, so instead of having
only true/false, we give the following results:

\[
    \text{acceptance}: \text{Stat} \rightarrow \{ \texttt{ok}, \texttt{fail},
        \texttt{nodata}, \texttt{abnormal}\}
\]

The semantics is as follows:

- `ok` means that the conditions is satisfied;
- `fail` means that the condition is not satisfied;
- `nodata` means that there is not enough data to check the condition. For example, there are conditions that reference the results of regression tests at another date; that data
might be not available;
- `abnormal` covers all abnormal conditions, including, for example, mistakes in writing
  the testing conditions.






The regression test engine does the following.

It reads the log test. It makes the logs available. (This might imply downloading
the logs.)


A physical log is a physical .bag file. These are generated


    regression1.regression_test.yaml

    description:
    Simple regression test.
    a
    logs:
    - "vehicle:ferrari,length:<10"
    processors:
    - transformer: Identity
    stats:
    visualizers:



    identity.job_processors.yaml
    description:
    constructor: IdentityProcessor
    parameters:


    count:


    S is a dict of YAML

    processor: Bag -> Bag
    analyzer: Bag -> S
    reduce: S x S -> S
    display_test: S -> Display


A regression test is characterized by

## Example of configuration file

Using an [EasyAlgo configuration file](#easy_algo), we can describe
a simple regression tests that counts the number of messages in a bag
in a file `example.regression_test.yaml` as follows:

    description: Simple regression test
    constructor: easy_regression.RegressionTest
    parameters:
        logs:
        - 20160223-amadoa-amadobot-RCDP2
        processors: []
        analyzers:
        - count_messages
        checks:
        - desc: The number of messages read should remain the same.
          cond: |
            v:count_messages/20160223-amadoa-amadobot-RCDP2/num_messages == 5330

In this example, there is only one log, no processors, and one analyzer.

There is one condition, that checks that the output of `count_messages` on that log is 5330.

    v:count_messages/20160223-amadoa-amadobot-RCDP2/num_messages == 5330

We can run this regression test using:

    $ rosrun easy_regression run --tests example




## Language for the conditions to check

There is a flexible language that allows to check conditions.

The simplest checks regarding checking the values:

    v:analyzer/log/statistics == value
    v:analyzer/log/statistics &gt;= value
    v:analyzer/log/statistics &lt;= value
    v:analyzer/log/statistics &lt; value
    v:analyzer/log/statistics &gt; value

Check that it is in 10% of the value:

    v:analyzer/log/statistics ==[10%] value

Use `@![date]` to reference the test result at that date.
For example,

    v:analyzer/log/statistics ==[10%] v:analyzer/log/statistic@2017-08-01

Use `~![branch]@![date]` to reference the value of a branch at a certain date:

    v:analyzer/log/statistics ==[10%] v:analyzer/log/statistic~master@2017-08-01

Use `?commit` to reference the value of a branch at a specific commit:

    v:analyzer/log/statistics ==[10%] v:analyzer/log/statistic?e9aa5f4
